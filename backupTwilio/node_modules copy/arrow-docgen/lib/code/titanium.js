// jscs:disable jsDoc

function generate(object, api, endpoint, opts) {
	var code = [];
	code.push('\t### Titanium Mobile Example for ' + endpoint.name);
	code.push('\tThis is an example you can use in your Titanium app:');
	code.push('```titanium');
	code.push('' +
		'var xhr = Ti.Network.createHTTPClient({\n' +
		'\tonload: function onLoad() {\n' +
		'\t\talert("Loaded: " + this.status + ": " + this.responseText);\n' +
		'\t},\n' +
		'\tonerror: function onError() {\n' +
		'\t\talert("Errored: " + this.status + ": " + this.responseText);\n' +
		'\t}\n' +
		'});\n');

	var url = opts.url;
	var idx = opts.url.indexOf('/:');
	if (idx > 0) {
		url = opts.url.substring(0, idx);
	}
	var q = [], b = {};
	endpoint.parameters && Object.keys(endpoint.parameters).forEach(function (k) {
		var param = endpoint.parameters[k];
		if (param.type === 'query') {
			q.push(param.name + '=' + param.default || '');
		} else if (param.type === 'path') {
			url += '/' + param.name.toUpperCase();
		} else {
			b[param.name] = param.default || '';
		}
	});
	if (q.length) {
		url += '?' + q.join('&');
	}
	code.push('xhr.open("' + endpoint.method + '","' + url + '");');

	if (object.server.auth) {
		if (object.server.auth.type === 'basic' || object.server.auth.type === 'ldap') {
			code.push('var authstr = \'Basic \' + Ti.Utils.base64encode(\'' + (object.server.auth.apikey || 'YOUR_APIKEY_GOES_HERE') + ':\');');
			code.push('xhr.setRequestHeader("Authorization", authstr);');
		} else if (object.server.auth.type === 'apikey') {
			code.push('xhr.setRequestHeader("APIKey", "' + (object.server.auth.apikey || 'YOUR_APIKEY_GOES_HERE') + '");');
		}
	}
	if (endpoint.method === 'POST' || endpoint.method === 'PUT') {
		code.push('xhr.setRequestHeader("Content-Type","application/json");');
	}

	if (Object.keys(b).length) {
		code.push('xhr.send(JSON.stringify(' + JSON.stringify(b, null, '\t') + '));');
	} else {
		code.push('xhr.send();');
	}

	code.push('```');
	return code.join('\n');
}

exports.generate = generate;
