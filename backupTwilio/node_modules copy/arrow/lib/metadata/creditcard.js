/**
 * This code is closed source and Confidential and Proprietary to
 * Appcelerator, Inc. All Rights Reserved.  This code MUST not be
 * modified, copied or otherwise redistributed without express
 * written permission of Appcelerator. This file is licensed as
 * part of the Appcelerator Platform and governed under the terms
 * of the Appcelerator license agreement.
 */
var _ = require('lodash');

exports = module.exports = CreditCard;

/**
 * A credit card type.
 * @param obj
 * @returns {*}
 * @constructor
 */
function CreditCard(obj) {
	return _.merge({
		type: 'text',
		subtype: 'creditcard',
		required: false,
		default: '',
		validator: validator
	}, obj);
}

var cards = [
	'(?:4[0-9]{12}(?:[0-9]{3})?)',		// Visa
	'5[1-5][0-9]{14}',					// MasterCard
	'3[47][0-9]{13}',					// American Express,
	'3(?:0[0-5]|[68][0-9])[0-9]{11}',	// Diners Club
	'6(?:011|5[0-9]{2})[0-9]{12}',		// Discover
	'(?:2131|1800|35\\d{3})\\d{11}',	// JCB
	'56105[6-9]\\d{2}\\d{4}\\d{4}'		// Australian BankCard
];

var validator = new RegExp('^(' + cards.map(function (c) {return '(' + c + ')';}).join('|') + ')$');

if (module.id === '.') {
	var testcards = [
		'378282246310005',
		'371449635398431',
		'378734493671000',
		'5610591081018250',
		'30569309025904',
		'38520000023237',
		'6011111111111117',
		'6011000990139424',
		'3530111333300000',
		'3566002020360505',
		'5555555555554444',
		'5105105105105100',
		'4111111111111111',
		'4012888888881881',
		'4222222222222'
	];

	testcards.forEach(function (cc) {
		console.log(cc + '=>', validator.test(cc));
	});
}
