var LdapAuth = require('./lib/ldapauth'), fs = require('fs');

var opts = {
  "url": "ldaps://v-eprdnetdc1.eprdnet.local:1398",
  "adminDn": "cn=Production Monitoring LDAP sa,ou=Service Accounts,OU=Zender,DC=EPRDNET,DC=local",
  "adminPassword": "R9vExzzv8pzMKxm",
  "searchBase": "OU=Zender,DC=EPRDNET,DC=local",
  "searchFilter": "(&(objectClass=person)(sAMAccountName={{username}}))",
  "searchAttributes": [
    "dn"
  ],
  "tlsOptions": {
    "ca": [fs.readFileSync("/home/vesse/Downloads/enfo/v-eprdnetdc1.pem")]
  }
};

var a = new LdapAuth(opts);
var c = 1;
var test = function() {
  console.log('Round', c);
  a.authenticate('extLVesaP', 'cx3gS0vIhQTEl', function(err, user) {
    console.log(err, user);
    c++;
    setTimeout(function() {
      test();
    }, 120000);
  });
}

setTimeout(function() {
  test();
}, 1);
